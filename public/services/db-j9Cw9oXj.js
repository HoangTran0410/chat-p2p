const i="ChatP2P_v1",n="chat_sessions";const m=()=>new Promise((r,o)=>{const e=indexedDB.open(i,1);e.onerror=()=>o(e.error),e.onupgradeneeded=t=>{const a=t.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"peerId"})},e.onsuccess=async()=>{await g(),r()}}),g=async()=>{const r="synapse_chats",o=localStorage.getItem(r);if(o)try{const e=JSON.parse(o);console.log("Migrating chats to IndexedDB...",Object.keys(e).length),await Promise.all(Object.values(e).map(t=>S(t))),localStorage.removeItem(r),console.log("Migration complete. LocalStorage cleared.")}catch(e){console.error("Migration failed:",e)}},S=r=>new Promise((o,e)=>{const t=indexedDB.open(i,1);t.onsuccess=()=>{const s=t.result.transaction(n,"readwrite").objectStore(n).put(r);s.onsuccess=()=>o(),s.onerror=()=>e(s.error)},t.onerror=()=>e(t.error)}),p=()=>new Promise((r,o)=>{const e=indexedDB.open(i,1);e.onsuccess=()=>{const c=e.result.transaction(n,"readonly").objectStore(n).getAll();c.onsuccess=()=>{const s=c.result,d={};s.forEach(u=>{d[u.peerId]=u}),r(d)},c.onerror=()=>o(c.error)},e.onerror=()=>o(e.error)}),b=r=>new Promise((o,e)=>{const t=indexedDB.open(i,1);t.onsuccess=()=>{const s=t.result.transaction(n,"readwrite").objectStore(n).delete(r);s.onsuccess=()=>o(),s.onerror=()=>e(s.error)},t.onerror=()=>e(t.error)});export{b as d,p as g,m as i,S as s};
