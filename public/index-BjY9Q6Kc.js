import{r as s,$ as St,j as D,X as Ee,H as wt,J as Ct}from"./vendor-BmvYEmtW.js";import{c as bt,v as xt,d as kt,e as Pt,a as Kt,b as je,i as Ne,g as _e,f as Fe,h as pe,j as vt}from"./services/crypto-DOdyDEE6.js";import{g as Te,s as Ae,a as Oe,b as Dt,c as L,i as Rt,d as Ue,e as Mt,f as Et,h as jt}from"./services/db-DHAJ5JWv.js";import{g as ne,a as Nt,b as _t,s as ze,c as le,d as Ft,e as Tt}from"./services/storage-D8gQH_9t.js";import{C as At}from"./components/chatsidebar-CJxPqdTa.js";import{C as Ot}from"./components/chatwindow-Dn8eCdck.js";import{S as Ut}from"./components/settingsmodal-BfSSLizx.js";import{S as zt}from"./components/syncmodal-C49R-M7X.js";import{N as Bt}from"./components/newsessiondialog-DMinUVmd.js";import{K as Lt}from"./components/keychangewarningmodal-CuD8avxj.js";import"./index-BjY9Q6Kc.js";import"./components/sessionswitcher-sP-IJ6Jt.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))X(n);new MutationObserver(n=>{for(const C of n)if(C.type==="childList")for(const z of C.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&X(z)}).observe(document,{childList:!0,subtree:!0});function V(n){const C={};return n.integrity&&(C.integrity=n.integrity),n.referrerPolicy&&(C.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?C.credentials="include":n.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function X(n){if(n.ep)return;n.ep=!0;const C=V(n);fetch(n.href,C)}})();function rn(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}const Be={host:"fbaio.xyz",port:443,path:"/peer",secure:!0,debug:3},Le=50,$t=({config:y=Be,sessionId:p,onMessageReceived:V,onConnectionOpened:X,onConnectionClosed:n,onConnectionLimitExceeded:C})=>{const[z,$]=s.useState(""),[v,T]=s.useState(null),h=s.useRef(new Map),B=s.useRef([]),[_,W]=s.useState({}),[Q,U]=s.useState(!1),[ee,J]=s.useState(!1),[Y,q]=s.useState(null),[te,F]=s.useState(null),P=(r,u)=>{W(w=>({...w,[r]:u}))},i=s.useCallback(r=>{P(r.peer,"connecting"),r.on("open",()=>{if(h.current.size>=Le){const u=B.current[0];if(u){const w=h.current.get(u);w&&w.close(),h.current.delete(u),B.current=B.current.filter(M=>M!==u),P(u,"disconnected"),n(u),C&&C(u)}}h.current.set(r.peer,r),B.current.push(r.peer),P(r.peer,"connected"),X(r.peer),r.send({type:"presence",status:"online"})}),r.on("data",u=>{u&&typeof u=="object"&&u.type==="presence"||V(r.peer,u)}),r.on("close",()=>{h.current.delete(r.peer),B.current=B.current.filter(u=>u!==r.peer),P(r.peer,"disconnected"),n(r.peer)}),r.on("error",u=>{console.error("Connection-specific error:",u),h.current.delete(r.peer),P(r.peer,"failed")})},[X,n,V]);s.useCallback(()=>{v&&(v.destroy(),T(null)),h.current.clear(),W({}),U(!1)},[v]);const g=s.useCallback(r=>{J(!0);const u=window.Peer||St,w=new u(r,{host:y.host,port:y.port,path:y.path,secure:y.secure,debug:y.debug||0});return w.on("open",M=>{console.log("My Peer ID is: "+M),U(!0),J(!1),q(null)}),w.on("connection",M=>{i(M)}),w.on("disconnected",()=>{console.log("Peer disconnected from server."),U(!1),setTimeout(()=>{w&&!w.destroyed&&(console.log("Attempting to reconnect..."),J(!0),w.reconnect())},3e3)}),w.on("error",M=>{if(console.error("PeerJS error:",M),J(!1),M.type==="unavailable-id")q("ID is already taken. Please choose another."),U(!1);else if(M.message&&M.message.includes("is taken"))q(`ID is taken: ${M.message}`),U(!1);else if(M.type==="peer-unavailable"){const Z=(M.message||"").match(/Could not connect to peer (.*)/);Z&&Z[1]?(P(Z[1],"failed"),F(`User '${Z[1]}' not found or offline.`)):F("Peer not found or offline.")}else M.type==="network"||M.type==="disconnected"?(U(!1),q("Network error. Reconnecting..."),setTimeout(()=>{w&&!w.destroyed&&(J(!0),w.reconnect())},3e3)):q("Connection error: "+(M.message||"Unknown error"))}),T(w),w},[i]);s.useEffect(()=>{if(!p)return;$(p);const r=g(p),u=()=>{r==null||r.destroy()};return window.addEventListener("beforeunload",u),()=>{window.removeEventListener("beforeunload",u),r==null||r.destroy()}},[p,y]);const f=s.useCallback(r=>{!r||r===z||(v&&v.destroy(),h.current.clear(),W({}),U(!1),q(null),F(null),$(r),g(r))},[z,v,g]),R=s.useCallback(r=>{if(!(!v||!Q)){if(h.current.has(r)){const u=h.current.get(r);if(u!=null&&u.open){P(r,"connected");return}}P(r,"connecting");try{const u=v.connect(r,{reliable:!0});i(u),setTimeout(()=>{W(w=>w[r]==="connecting"?{...w,[r]:"failed"}:w)},1e4)}catch(u){console.error("Connect error",u),P(r,"failed")}}},[v,Q,i]),S=s.useCallback(r=>{const u=h.current.get(r);u&&(u.close(),h.current.delete(r)),P(r,"disconnected")},[]),E=s.useCallback((r,u)=>{const w=h.current.get(r);return w&&w.open?(w.send(u),!0):!1},[]);return{myId:z,isReady:Q,isReconnecting:ee,peerError:Y,connectionError:te,resetConnectionError:()=>F(null),connectionStates:_,activeConnectionsCount:Array.from(h.current.values()).filter(r=>r==null?void 0:r.open).length,connectToPeer:R,disconnectPeer:S,sendMessage:E,updateId:f}};function Wt({sessionId:y,onKeyChange:p}){const[V,X]=s.useState(!1),[n,C]=s.useState(null),[z,$]=s.useState(null),v=s.useRef(null),T=s.useRef(null),h=s.useRef(new Map),[,B]=s.useState({}),_=s.useCallback(()=>B({}),[]);s.useEffect(()=>{if(!y)return;(async()=>{try{const g=await Dt(y);if(g){const S=await Ne({publicKey:g.identityPubKey,privateKey:g.identityPrivKey});v.current=S}else{const S=await vt();v.current=S;const E=await je(S),H={sessionId:y,identityPubKey:E.publicKey,identityPrivKey:E.privateKey,createdAt:Date.now()};await Oe(H)}T.current=await pe();const f=await _e(v.current.publicKey),R=await Fe(v.current.publicKey);C(f),$(R),X(!0)}catch(g){console.error("Failed to initialize encryption:",g)}})()},[y]);const W=s.useCallback(async()=>!v.current||!T.current?null:bt(v.current,T.current),[]),Q=s.useCallback(async(i,g)=>{if(!T.current)return!1;try{const f=await xt(g);if(!f.valid||!f.sessionKey||!f.fingerprint)return console.warn("Invalid key exchange from",i),!1;const R=await kt(T.current.privateKey,f.sessionKey),S=await Te(i);let E=!1;S&&S.fingerprint!==f.fingerprint&&(E=!0,p&&p(i,S.fingerprint,f.fingerprint)),h.current.set(i,{sessionKey:R,fingerprint:f.fingerprint,verified:(S==null?void 0:S.verified)||!1,keyChanged:E});const H={peerId:i,identityPubKey:g.identityPubKey,fingerprint:f.fingerprint,firstSeen:(S==null?void 0:S.firstSeen)||Date.now(),lastSeen:Date.now(),verified:(S==null?void 0:S.verified)||!1};return await Ae(H),_(),!0}catch(f){return console.error("Key exchange failed:",f),!1}},[p,_]),U=s.useCallback(async(i,g)=>{const f=h.current.get(i);if(!(f!=null&&f.sessionKey))return console.warn("No session key for peer:",i),null;try{return await Pt(g,f.sessionKey)}catch(R){return console.error("Encryption failed:",R),null}},[]),ee=s.useCallback(async(i,g)=>{const f=h.current.get(i);if(!(f!=null&&f.sessionKey))return console.warn("No session key for peer:",i),null;try{return await Kt(g,f.sessionKey)}catch(R){return console.error("Decryption failed:",R),null}},[]),J=s.useCallback(i=>{var g;return((g=h.current.get(i))==null?void 0:g.fingerprint)||null},[]),Y=s.useCallback(i=>{var g;return h.current.has(i)&&((g=h.current.get(i))==null?void 0:g.sessionKey)!==null},[]),q=s.useCallback(async i=>{const g=h.current.get(i);if(!g)return;g.verified=!0,g.keyChanged=!1;const f=await Te(i);f&&(f.verified=!0,await Ae(f)),_()},[_]),te=s.useCallback(async()=>{if(!v.current)return null;try{const i=await je(v.current);return JSON.stringify({sessionId:y,keys:i,exportedAt:Date.now()},null,2)}catch(i){return console.error("Failed to export keys:",i),null}},[y]),F=s.useCallback(async i=>{var g,f;try{const R=JSON.parse(i);if(!((g=R.keys)!=null&&g.publicKey)||!((f=R.keys)!=null&&f.privateKey))throw new Error("Invalid key format");const S=await Ne(R.keys);v.current=S;const E={sessionId:y,identityPubKey:R.keys.publicKey,identityPrivKey:R.keys.privateKey,createdAt:R.exportedAt||Date.now()};await Oe(E);const H=await _e(S.publicKey),r=await Fe(S.publicKey);return C(H),$(r),T.current=await pe(),!0}catch(R){return console.error("Failed to import keys:",R),!1}},[y]),P=s.useCallback(async()=>{T.current=await pe(),h.current.clear(),_()},[_]);return{isReady:V,myFingerprint:n,myShortFingerprint:z,identityKeyPair:v.current,sessionKeyPair:T.current,peerStates:h.current,createKeyExchange:W,handleKeyExchange:Q,encrypt:U,decrypt:ee,getPeerFingerprint:J,hasPeerKey:Y,markPeerVerified:q,exportMyKeys:te,importMyKeys:F,regenerateSessionKey:P}}const ge=64*1024,on=50*1024*1024;function Jt(){var Re,Me;const[y,p]=s.useState({}),[V,X]=s.useState(!1),[n,C]=s.useState(null),[z,$]=s.useState(!1),[v,T]=s.useState({}),[h,B]=s.useState([]),[_,W]=s.useState(""),[Q,U]=s.useState(!1),[ee,J]=s.useState(!1),[Y,q]=s.useState(()=>{const t=localStorage.getItem("peer_config");return t?JSON.parse(t):Be}),[te,F]=s.useState("idle"),[P,i]=s.useState(null),[g,f]=s.useState(null),[R,S]=s.useState(null),[E,H]=s.useState(null),[r,u]=s.useState(()=>{const t=window.location.hash;if(t.startsWith("#connect=")){const e=t.slice(9);return window.history.replaceState(null,"",window.location.pathname+window.location.search),e}return null}),[w,M]=s.useState(null),[me,Z]=s.useState(null),se=s.useRef(new Map),A=s.useRef("");s.useEffect(()=>{A.current=_},[_]);const I=s.useRef(()=>!1),he=s.useRef(async()=>!1),ue=s.useRef(async()=>null),Se=s.useRef(()=>{}),we=s.useRef(()=>!1);s.useEffect(()=>{(async()=>{try{await Rt();let e=Nt(),l=_t();if(e.length===0){const x=ne(),k={id:x,createdAt:Date.now()};ze(k),le(x),e=[k],l=x}else(!l||!e.find(x=>x.id===l))&&(l=e[0].id,le(l));B(e),W(l);const b=await Ue(l);p(b)}catch(e){console.error("Failed to init storage:",e)}finally{X(!0)}})()},[]);const We=t=>{q(t),localStorage.setItem("peer_config",JSON.stringify(t))},de=s.useCallback((t,e)=>{if(e&&typeof e=="object"&&e.type==="typing"){T(a=>({...a,[t]:e.isTyping}));return}if(e&&typeof e=="object"&&e.type==="presence")return;if(e&&typeof e=="object"&&e.type==="key_exchange"){const a=we.current(t);he.current(t,e).then(o=>{o&&(console.log("Key exchange completed with",t),a||ue.current().then(c=>{c&&I.current(t,{type:"key_exchange",...c})}))});return}if(e&&typeof e=="object"&&e.type==="encrypted_message"){Ke.current(t,e.payload).then(a=>{if(a)try{const o=JSON.parse(a);Se.current(t,{...o,_encrypted:!0})}catch{console.error("Failed to parse decrypted message")}});return}if(e&&typeof e=="object"&&e.type==="receipt"){const{messageId:a,status:o,timestamp:c}=e;p(d=>{const m=d[t];if(!m)return d;const K=m.messages.map(N=>{if(N.id===a){if(o==="delivered")return{...N,status:"delivered",receivedAt:c};if(o==="read")return{...N,status:"read",readAt:c}}return N}),j={...m,messages:K};return L(A.current,j),{...d,[t]:j}});return}if(e&&typeof e=="object"&&e.type==="file_start"){const{fileId:a,fileName:o,fileSize:c,mimeType:d,totalChunks:m,messageType:K}=e,j={id:a,fileName:o,fileSize:c,mimeType:d,totalChunks:m,receivedChunks:new Map,progress:0,messageType:K||"file"};se.current.set(a,j),Z({fileId:a,fileName:o,progress:0});return}if(e&&typeof e=="object"&&e.type==="file_chunk"){const{fileId:a,chunkIndex:o,data:c}=e,d=se.current.get(a);if(!d)return;d.receivedChunks.set(o,c);const m=Math.round(d.receivedChunks.size/d.totalChunks*100);d.progress=m,Z({fileId:a,fileName:d.fileName,progress:m});return}if(e&&typeof e=="object"&&e.type==="file_end"){const{fileId:a}=e,o=se.current.get(a);if(!o)return;const c=[];for(let K=0;K<o.totalChunks;K++){const j=o.receivedChunks.get(K);j&&c.push(j)}const d=new Blob(c),m={id:ne(),senderId:t,content:o.fileName,timestamp:Date.now(),receivedAt:Date.now(),status:"delivered",type:o.messageType,file:{name:o.fileName,size:o.fileSize,mimeType:o.mimeType,data:d}};p(K=>{const j=K[t]||{peerId:t,messages:[],lastUpdated:Date.now(),unreadCount:0},N={...j,messages:[...j.messages,m],lastUpdated:Date.now(),unreadCount:n===t?0:j.unreadCount+1};return L(A.current,N),{...K,[t]:N}}),I.current(t,{type:"receipt",messageId:m.id,status:"delivered",timestamp:Date.now()}),se.current.delete(a),Z(null);return}if(e&&typeof e=="object"&&e.type==="sync_request"){F("incoming"),i(t);return}if(e&&typeof e=="object"&&e.type==="sync_reject"){F("idle"),i(null),alert(`${t} declined the sync request.`);return}if(e&&typeof e=="object"&&e.type==="sync_cancel"){F("idle"),i(null);return}if(e&&typeof e=="object"&&(e.type==="sync_data_initial"||e.type==="sync_data_final")){const a=e.messages;if(!Array.isArray(a))return;p(o=>{const c=o[t]||{peerId:t,messages:[],lastUpdated:Date.now(),unreadCount:0},d=new Set(c.messages.map(N=>N.id)),m=a.filter(N=>!d.has(N.id));if(m.length===0&&e.type==="sync_data_final")return o;const K=[...c.messages,...m].sort((N,ht)=>N.timestamp-ht.timestamp),j={...c,messages:K};return L(A.current,j),e.type==="sync_data_initial"&&I.current(t,{type:"sync_data_final",messages:K}),{...o,[t]:j}}),f({phase:e.type==="sync_data_initial"?"Receiving":"Merging",count:a.length}),setTimeout(()=>{F("idle"),i(null),f(null)},500);return}const l=e.id||ne(),b=e.timestamp||Date.now(),x=e._encrypted===!0;let k;typeof e=="string"?k={id:l,senderId:t,content:e,timestamp:b,receivedAt:Date.now(),status:"delivered",type:"text",encrypted:!1}:k={id:l,senderId:t,content:e.content||"",timestamp:b,receivedAt:Date.now(),status:"delivered",type:e.type||"text",file:e.file,encrypted:x},!(!k.content&&!k.file)&&(I.current(t,{type:"receipt",messageId:l,status:"delivered",timestamp:Date.now()}),p(a=>{const o=a[t]||{peerId:t,messages:[],lastUpdated:Date.now(),unreadCount:0},c={...o,messages:[...o.messages,k],lastUpdated:Date.now(),unreadCount:n===t?0:o.unreadCount+1},d={...a,[t]:c};return L(A.current,c),d}))},[n]),Je=s.useCallback(t=>{p(e=>{if(!e[t]){const l={peerId:t,messages:[],lastUpdated:Date.now(),unreadCount:0};return L(A.current,l),{...e,[t]:l}}return e}),ue.current().then(e=>{e&&I.current(t,{type:"key_exchange",...e})}),window.innerWidth>=768&&C(e=>e||t)},[]),qe=s.useCallback(t=>{T(e=>({...e,[t]:!1}))},[]),{myId:G,activeConnectionsCount:He,connectToPeer:re,disconnectPeer:fe,sendMessage:O,updateId:Ce,peerError:be,connectionError:xe,resetConnectionError:Xe,isReady:oe,connectionStates:ae,isReconnecting:Ge}=$t({config:Y,sessionId:_,onMessageReceived:de,onConnectionOpened:Je,onConnectionClosed:qe,onConnectionLimitExceeded:t=>{var l;const e=((l=y[t])==null?void 0:l.name)||t.slice(0,8);S(`Disconnected "${e}" - max ${Le} connections reached`),setTimeout(()=>S(null),4e3)}}),{myFingerprint:Ve,createKeyExchange:ke,handleKeyExchange:Pe,encrypt:ce,decrypt:ye,getPeerFingerprint:Ze,hasPeerKey:ie,markPeerVerified:Qe,exportMyKeys:Ye,importMyKeys:Ie}=Wt({sessionId:_,onKeyChange:(t,e,l)=>{H({peerId:t,oldFingerprint:e,newFingerprint:l})}}),et=s.useRef(ce),Ke=s.useRef(ye);s.useEffect(()=>{et.current=ce,Ke.current=ye,he.current=Pe,ue.current=ke,we.current=ie},[ce,ye,Pe,ke,ie]),s.useEffect(()=>{I.current=O},[O]),s.useEffect(()=>{Se.current=de},[de]),s.useEffect(()=>{oe&&r&&r!==G&&(console.log("Auto-connecting to peer from URL:",r),re(r),C(r),u(null))},[oe,r,G,re]);const tt=async t=>{if(!n)return;const e=ne(),l=Date.now();let b={id:e,timestamp:l};typeof t=="string"?(b.content=t,b.type="text"):b={...b,...t};const x=ie(n);let k=!1,a=!1;if(x){const o=await ce(n,JSON.stringify(b));o?(k=O(n,{type:"encrypted_message",payload:o}),a=!0):k=O(n,b)}else k=O(n,b);if(k){const o={id:e,senderId:G,content:b.content||"",timestamp:l,status:"sent",type:b.type,file:b.file,encrypted:a};p(c=>{const d=c[n]||{peerId:n,messages:[],lastUpdated:Date.now(),unreadCount:0},m={...d,messages:[...d.messages,o],lastUpdated:Date.now()},K={...c,[n]:m};return L(A.current,m),K}),setTimeout(()=>{p(c=>{const d=c[n];if(!d)return c;const m=d.messages.find(K=>K.id===e);if(m&&m.status==="sent"){const K=d.messages.map(N=>N.id===e?{...N,status:"failed"}:N),j={...d,messages:K};return L(A.current,j),{...c,[n]:j}}return c})},1e4)}else{const o={id:e,senderId:G,content:b.content||"",timestamp:l,status:"failed",type:b.type,file:b.file};p(c=>{const d=c[n]||{peerId:n,messages:[],lastUpdated:Date.now(),unreadCount:0},m={...d,messages:[...d.messages,o],lastUpdated:Date.now()},K={...c,[n]:m};return L(A.current,m),K})}},nt=async(t,e,l)=>{if(!n)return;const b=Math.ceil(e.size/ge),x=await e.arrayBuffer();O(n,{type:"file_start",fileId:t,fileName:e.name,fileSize:e.size,mimeType:e.type,totalChunks:b,messageType:l});const k={id:t,senderId:G,content:e.name,timestamp:Date.now(),status:"sending",type:l,file:{name:e.name,size:e.size,mimeType:e.type,data:new Blob([x])}};p(a=>{const o=a[n]||{peerId:n,messages:[],lastUpdated:Date.now(),unreadCount:0},c={...o,messages:[...o.messages,k],lastUpdated:Date.now()};return{...a,[n]:c}});for(let a=0;a<b;a++){const o=a*ge,c=Math.min(o+ge,e.size),d=x.slice(o,c);O(n,{type:"file_chunk",fileId:t,chunkIndex:a,data:d});const m=Math.round((a+1)/b*100);M({fileId:t,progress:m}),await new Promise(K=>setTimeout(K,10))}O(n,{type:"file_end",fileId:t}),p(a=>{const o=a[n];if(!o)return a;const c=o.messages.map(m=>m.id===t?{...m,status:"sent"}:m),d={...o,messages:c};return L(A.current,d),{...a,[n]:d}}),M(null)},st=t=>{n&&O(n,{type:"typing",isTyping:t})},rt=t=>{if(!n)return;const e=y[n];if(!e)return;const l=e.messages.find(x=>x.id===t);if(!l||l.status!=="failed")return;O(n,{id:l.id,content:l.content,timestamp:l.timestamp})&&(p(x=>{const k=x[n];if(!k)return x;const a=k.messages.map(c=>c.id===t?{...c,status:"sent"}:c),o={...k,messages:a};return L(A.current,o),{...x,[n]:o}}),setTimeout(()=>{p(x=>{const k=x[n];if(!k)return x;const a=k.messages.find(o=>o.id===t);if(a&&a.status==="sent"){const o=k.messages.map(d=>d.id===t?{...d,status:"failed"}:d),c={...k,messages:o};return L(A.current,c),{...x,[n]:c}}return x})},1e4))},ot=()=>{n&&(O(n,{type:"sync_request"}),F("outgoing"),i(n))},at=()=>{P&&O(P,{type:"sync_cancel"}),F("idle"),i(null)},ct=()=>{if(!P)return;const t=y[P],e=t?t.messages:[];F("outgoing"),f({phase:"Sending",count:e.length}),O(P,{type:"sync_data_initial",messages:e}),setTimeout(()=>{F("idle"),i(null),f(null)},800)},it=()=>{P&&(O(P,{type:"sync_reject"}),F("idle"),i(null))},ve=t=>{re(t),C(t),$(!1)},lt=()=>{n&&confirm("Are you sure you want to delete this conversation?")&&(fe(n),p(t=>{const e={...t};return delete e[n],Mt(A.current,n),e}),C(null))},De=(t,e)=>{p(l=>{const b=l[t];if(!b)return l;const x={...b,name:e.trim()===""?void 0:e.trim()};return L(A.current,x),{...l,[t]:x}})},ut=()=>{C(null),$(!1)},dt=async t=>{if(t!==_){C(null),p({}),le(t),W(t);try{const e=await Ue(t);p(e)}catch(e){console.error("Failed to load chats for session:",e)}}},ft=()=>{U(!0)},yt=async()=>{const t=ne(),e={id:t,createdAt:Date.now()};ze(e);const l=[...h,e];B(l),le(t),W(t),p({}),C(null),U(!1)},pt=async t=>{if(t!==_){Ft(t);try{await Et(t)}catch(e){console.error("Failed to delete chats for session:",e)}B(e=>e.filter(l=>l.id!==t))}},gt=async()=>{try{await jt(),Tt(),window.location.reload()}catch(t){console.error("Failed to clear data:",t),alert("Failed to clear data completely. Please try refreshing.")}},mt=Object.keys(ae).filter(t=>ae[t]==="connected");return V?D.jsxs("div",{className:"flex h-screen overflow-hidden bg-slate-950 text-slate-100 font-sans selection:bg-primary-500/30 relative",children:[xe&&D.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-50 animate-in fade-in slide-in-from-bottom-4",children:D.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 backdrop-blur-md text-red-200 px-4 py-3 rounded-lg shadow-xl flex items-center gap-3",children:[D.jsx("span",{className:"text-sm font-medium",children:xe}),D.jsx("button",{onClick:Xe,className:"p-1 hover:bg-red-500/20 rounded-full transition-colors",children:D.jsx(Ee,{className:"w-4 h-4"})})]})}),R&&D.jsx("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 z-50 animate-in fade-in slide-in-from-bottom-4",children:D.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/50 backdrop-blur-md text-yellow-200 px-4 py-3 rounded-lg shadow-xl flex items-center gap-3",children:[D.jsx("span",{className:"text-sm font-medium",children:R}),D.jsx("button",{onClick:()=>S(null),className:"p-1 hover:bg-yellow-500/20 rounded-full transition-colors",children:D.jsx(Ee,{className:"w-4 h-4"})})]})}),D.jsx("div",{className:`
        ${n||z?"hidden md:flex":"flex"}
        w-full md:w-80 flex-col border-r border-slate-800
      `,children:D.jsx(At,{myId:G,chats:y,activeConnections:mt,selectedPeerId:n,onSelectPeer:t=>{C(t),$(!1),ae[t]!=="connected"&&re(t)},onConnect:ve,onRenameChat:De,onShowDashboard:()=>$(!0),peerError:be,isReady:oe,onRetry:()=>Ce(G),onOpenSettings:()=>J(!0),sessions:h,activeSessionId:_,onSwitchSession:dt,onCreateNewSession:ft,onDeleteSession:pt,isReconnecting:Ge})}),D.jsx("div",{className:`
        ${n||z?"flex":"hidden md:flex"}
        flex-1 flex-col min-w-0 bg-slate-950
      `,children:D.jsx(Ot,{myId:G,peerId:n||"",session:n?y[n]:void 0,connectionState:n&&ae[n]||"disconnected",onSendMessage:tt,onDeleteChat:lt,onBack:ut,onConnect:()=>n&&ve(n),onCancelConnection:()=>n&&fe(n),isReady:oe,activeConnectionsCount:He,totalChats:Object.keys(y).length,isPeerTyping:n?v[n]:!1,onTyping:st,peerError:be,onRetry:()=>Ce(G),onRenameChat:t=>n&&De(n,t),onResendMessage:rt,onRequestSync:ot,onSendFileChunked:nt,sendingProgress:w,receivingProgress:me,peerFingerprint:n?Ze(n):null,isEncrypted:n?ie(n):!1})}),D.jsx(zt,{status:te,targetPeerId:P,peerName:P?(Re=y[P])==null?void 0:Re.name:void 0,progress:g,onCancel:at,onAccept:ct,onReject:it}),D.jsx(Bt,{isOpen:Q,onClose:()=>U(!1),onConfirm:yt}),ee&&D.jsx(Ut,{config:Y,onSave:We,onClose:()=>J(!1),onClearData:gt,myFingerprint:Ve,onExportKeys:Ye,onImportKeys:Ie}),D.jsx(Lt,{warning:E,peerName:E?(Me=y[E.peerId])==null?void 0:Me.name:void 0,onDisconnect:()=>{E&&(fe(E.peerId),H(null))},onTrust:()=>{E&&(Qe(E.peerId),H(null))}})]}):D.jsx("div",{className:"h-screen w-screen flex items-center justify-center bg-slate-950 text-white",children:"Initializing..."})}const $e=document.getElementById("root");if(!$e)throw new Error("Could not find root element to mount to");const qt=wt.createRoot($e);qt.render(D.jsx(Ct.StrictMode,{children:D.jsx(Jt,{})}));export{Be as D,ge as F,on as M,rn as g};
