import{r as n,j as e,z as g,B as O,D as z,C as j,E as L,R as B,y as U,T as Y,P as q}from"../vendor-CdBe9qih.js";import{u as F,a as G}from"../index-Fs2phppL.js";import{N as H}from"./newsessiondialog-Bx6hUwZz.js";import{s as J,g as K,a as M}from"../services/storage-CphQKvNS.js";const _=()=>{const{setChats:N,setSelectedPeerId:b,sessions:r,activeSessionId:l,switchSession:v,setSessions:S,createNewSession:Q,setActiveSessionId:C,deleteSession:y,showNewSessionDialog:k,setShowNewSessionDialog:i}=F(),{isReady:h,peerError:D,isReconnecting:p,myId:u,updateId:I}=G(),[c,o]=n.useState(!1),[f,d]=n.useState(null),[R,w]=n.useState(!1),m=n.useRef(null),x=r.find(s=>s.id===l),P=()=>{u&&I(u)};n.useEffect(()=>{const s=t=>{m.current&&!m.current.contains(t.target)&&(o(!1),d(null))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const A=(s,t)=>{s.stopPropagation(),f===t?(y(t),d(null)):d(t)},E=s=>{s.stopPropagation(),navigator.clipboard.writeText(l),w(!0),setTimeout(()=>w(!1),2e3)},$=async()=>{const s=K(),t={id:s,createdAt:Date.now()};J(t);const a=[...r,t];S(a),M(s),C(s),N({}),b(null),i(!1)};return e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>o(!c),className:"flex-1 flex items-center justify-between gap-2 px-3 py-2 bg-slate-800/50 hover:bg-slate-800 border border-slate-700 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary-600 flex items-center justify-center shrink-0",children:e.jsx(g,{className:"w-3.5 h-3.5 text-white"})}),e.jsx(O,{className:`absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 ${D?"fill-red-500 text-red-500":h?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex flex-col items-start min-w-0",children:[e.jsx("span",{className:"text-[10px] text-slate-500 uppercase tracking-wider",children:"Your ID"}),e.jsx("span",{className:"text-sm text-slate-200 font-mono",children:(x==null?void 0:x.name)||l})]})]}),e.jsx(z,{className:`w-4 h-4 text-slate-400 transition-transform ${c?"rotate-180":""}`})]}),e.jsx("button",{onClick:E,className:"p-2.5 bg-slate-800/50 hover:bg-slate-800 border border-slate-700 rounded-lg transition-colors text-slate-400 hover:text-white",title:"Copy ID",children:R?e.jsx(j,{className:"w-4 h-4 text-green-500"}):e.jsx(L,{className:"w-4 h-4"})}),!h&&e.jsx("button",{onClick:s=>{s.stopPropagation(),P()},className:"p-2.5 bg-slate-800/50 hover:bg-slate-800 border border-slate-700 rounded-lg text-slate-400 transition-colors group",title:"Retry Connection",disabled:p,children:e.jsx(B,{className:`w-4 h-4 ${p?"animate-spin":"group-hover:animate-spin"}`})})]}),c&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-150",children:[e.jsx("div",{className:"py-1 max-h-60 overflow-y-auto",children:r.map(s=>{const t=s.id===l,a=f===s.id;return e.jsxs("div",{className:`flex items-center justify-between px-3 py-2 cursor-pointer transition-colors ${t?"bg-primary-600/20 text-white":"hover:bg-slate-800 text-slate-300"}`,onClick:()=>{a||(v(s.id),o(!1))},children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center shrink-0 ${t?"bg-primary-600":"bg-slate-700"}`,children:t?e.jsx(j,{className:"w-3 h-3 text-white"}):e.jsx(g,{className:"w-3 h-3 text-slate-400"})}),e.jsx("span",{className:"font-mono text-sm truncate",children:s.name||s.id})]}),!t&&r.length>1&&e.jsx("button",{onClick:T=>A(T,s.id),className:`p-1 rounded transition-colors ${a?"bg-red-500/20 text-red-400":"hover:bg-slate-700 text-slate-500 hover:text-slate-300"}`,title:a?"Click again to confirm":"Delete session",children:a?e.jsx(U,{className:"w-3.5 h-3.5"}):e.jsx(Y,{className:"w-3.5 h-3.5"})})]},s.id)})}),e.jsx("div",{className:"border-t border-slate-700",children:e.jsxs("button",{onClick:()=>{i(!0),o(!1)},className:"w-full flex items-center gap-2 px-3 py-2.5 text-primary-400 hover:bg-slate-800 transition-colors",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"New Session"})]})})]}),e.jsx(H,{isOpen:k,onClose:()=>i(!1),onConfirm:$})]})};export{_ as S};
