import{r as i,j as e,E as S,X as D,H as R,t as E,g as L,C as T,w as F,J as I,K as P}from"../vendor--tW1iPYm.js";import{u as U,D as A}from"../index-D_-ulTpq.js";import{c as q}from"../services/db-C51VnwX1.js";import{c as B}from"../services/storage-DVVzbgBO.js";const _=({config:f,onSave:j,myFingerprint:c,onExportKeys:p,onImportKeys:u})=>{const{setShowSettings:y}=U(),[r,d]=i.useState(f),[w,h]=i.useState(!1),[o,b]=i.useState("idle"),g=i.useRef(null),n=t=>{const{name:l,value:s,type:a,checked:m}=t.target;d(C=>({...C,[l]:a==="checkbox"?m:a==="number"?parseInt(s):s}))},N=async()=>{try{await q(),B(),window.location.reload()}catch(t){console.error("Failed to clear data:",t),alert("Failed to clear data completely. Please try refreshing.")}},v=()=>{d(A)},x=()=>{y(!1)},k=t=>{t.preventDefault(),j(r),x()};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-md w-full shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-primary-500"}),"Settings"]}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:k,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"PeerJS Host"}),e.jsx("input",{type:"text",name:"host",value:r.host,onChange:n,placeholder:"0.peerjs.com",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-primary-500 transition-colors",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Port"}),e.jsx("input",{type:"number",name:"port",value:r.port,onChange:n,placeholder:"443",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-primary-500 transition-colors",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"Path"}),e.jsx("input",{type:"text",name:"path",value:r.path,onChange:n,placeholder:"/myapp",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-primary-500 transition-colors",required:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-6 pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",name:"secure",checked:r.secure,onChange:n,className:"w-4 h-4 rounded border-slate-600 bg-slate-950 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:"Secure (HTTPS/WSS)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",name:"debug",checked:!!r.debug,onChange:t=>d({...r,debug:t.target.checked?3:0}),className:"w-4 h-4 rounded border-slate-600 bg-slate-950 text-primary-600 focus:ring-primary-500 focus:ring-offset-slate-900"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:"Debug Logs"})]})]})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-between gap-4",children:[e.jsxs("button",{type:"button",onClick:v,className:"px-4 py-2 text-sm font-medium text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Reset"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:x,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 text-sm font-medium bg-primary-600 hover:bg-primary-500 text-white rounded-lg transition-colors flex items-center gap-2 shadow-lg shadow-primary-900/20",children:[e.jsx(E,{className:"w-4 h-4"}),"Save"]})]})]})]}),c&&e.jsxs("div",{className:"px-6 py-4 bg-primary-500/5 border-t border-primary-500/20",children:[e.jsxs("h3",{className:"text-xs font-bold text-primary-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),"End-to-End Encryption"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Your Identity Fingerprint"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-slate-950 px-3 py-2 rounded text-xs font-mono text-slate-300 overflow-hidden text-ellipsis",children:c.split(" ").slice(0,8).join(" ")}),e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(c),h(!0),setTimeout(()=>h(!1),2e3)},className:"p-2 bg-slate-800 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors",title:"Copy full fingerprint",children:w?e.jsx(T,{className:"w-4 h-4 text-green-400"}):e.jsx(F,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsxs("button",{type:"button",onClick:async()=>{const t=await p();if(t){const l=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(l),a=document.createElement("a");a.href=s,a.download="ping-identity-keys.json",a.click(),URL.revokeObjectURL(s)}},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-medium rounded transition-colors",children:[e.jsx(I,{className:"w-3.5 h-3.5"}),"Export Keys"]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:g,accept:".json",className:"hidden",onChange:async t=>{var s;const l=(s=t.target.files)==null?void 0:s[0];if(l){const a=await l.text(),m=await u(a);b(m?"success":"error"),setTimeout(()=>b("idle"),2e3)}}}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=g.current)==null?void 0:t.click()},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium rounded transition-colors ${o==="success"?"bg-green-500/20 text-green-400":o==="error"?"bg-red-500/20 text-red-400":"bg-slate-800 hover:bg-slate-700 text-slate-300"}`,children:[e.jsx(P,{className:"w-3.5 h-3.5"}),o==="success"?"Imported!":o==="error"?"Failed":"Import Keys"]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-red-500/5 border-t border-red-500/20",children:[e.jsx("h3",{className:"text-xs font-bold text-red-500 uppercase tracking-wider mb-2",children:"Danger Zone"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-red-400/80",children:"Clear all chats, sessions, and local data."}),e.jsx("button",{type:"button",onClick:()=>{confirm("Are you sure? This will wipe ALL your data including chat history and sessions. This action cannot be undone.")&&N()},className:"px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-500 text-xs font-medium rounded transition-colors",children:"Clear All Data"})]})]})]})})};export{_ as S};
