import{r as l,j as e,H as g,X as y,d as w,C as N,E as v,J as C,K as S}from"../vendor-DoBkD9ct.js";import{c as k}from"../services/db-DWyvzVjS.js";import{c as D}from"../services/storage-CphQKvNS.js";import{u as E}from"../index-CxuO6HPh.js";const z=({config:p,onSave:R,myFingerprint:n,onExportKeys:i,onImportKeys:c})=>{const{setShowSettings:u}=E(),[L,T]=l.useState(p),[h,d]=l.useState(!1),[r,x]=l.useState("idle"),m=l.useRef(null),b=async()=>{try{await k(),D(),window.location.reload()}catch(t){console.error("Failed to clear data:",t),alert("Failed to clear data completely. Please try refreshing.")}},f=()=>{u(!1)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl max-w-md w-full shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-primary-500"}),"Settings"]}),e.jsx("button",{onClick:f,className:"p-1 hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx(y,{className:"w-5 h-5"})})]}),n&&e.jsxs("div",{className:"px-6 py-4 bg-primary-500/5 border-t border-primary-500/20",children:[e.jsxs("h3",{className:"text-xs font-bold text-primary-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(w,{className:"w-3.5 h-3.5"}),"End-to-End Encryption"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Your Identity Fingerprint"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-slate-950 px-3 py-2 rounded text-xs font-mono text-slate-300 overflow-hidden text-ellipsis",children:n.split(" ").slice(0,8).join(" ")}),e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(n),d(!0),setTimeout(()=>d(!1),2e3)},className:"p-2 bg-slate-800 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors",title:"Copy full fingerprint",children:h?e.jsx(N,{className:"w-4 h-4 text-green-400"}):e.jsx(v,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[i&&e.jsxs("button",{type:"button",onClick:async()=>{const t=await i();if(t){const o=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download="ping-identity-keys.json",a.click(),URL.revokeObjectURL(s)}},className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-medium rounded transition-colors",children:[e.jsx(C,{className:"w-3.5 h-3.5"}),"Export Keys"]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:m,accept:".json",className:"hidden",onChange:async t=>{var s;const o=(s=t.target.files)==null?void 0:s[0];if(o){const a=await o.text(),j=await c(a);x(j?"success":"error"),setTimeout(()=>x("idle"),2e3)}}}),e.jsxs("button",{type:"button",onClick:()=>{var t;return(t=m.current)==null?void 0:t.click()},className:`flex-1 flex items-center justify-center gap-2 px-3 py-2 text-xs font-medium rounded transition-colors ${r==="success"?"bg-green-500/20 text-green-400":r==="error"?"bg-red-500/20 text-red-400":"bg-slate-800 hover:bg-slate-700 text-slate-300"}`,children:[e.jsx(S,{className:"w-3.5 h-3.5"}),r==="success"?"Imported!":r==="error"?"Failed":"Import Keys"]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-red-500/5 border-t border-red-500/20",children:[e.jsx("h3",{className:"text-xs font-bold text-red-500 uppercase tracking-wider mb-2",children:"Danger Zone"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-red-400/80",children:"Clear all chats, sessions, and local data."}),e.jsx("button",{type:"button",onClick:()=>{confirm("Are you sure? This will wipe ALL your data including chat history and sessions. This action cannot be undone.")&&b()},className:"px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 text-red-500 text-xs font-medium rounded transition-colors",children:"Clear All Data"})]})]})]})})};export{z as S};
