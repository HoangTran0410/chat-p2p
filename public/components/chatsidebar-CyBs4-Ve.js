import{r as n,j as e,M as ee,L as se,S as te,G as ae,C as le,a as re,P as S,U as b,b as ne,f as R,c as ie,d as oe}from"../vendor--tW1iPYm.js";import{S as ce}from"./sessionswitcher-C0a3MZR2.js";import{u as de}from"../index-D_-ulTpq.js";const he=({myId:i,chats:P,activeConnections:$,onSelectPeer:g,onConnect:D,onRenameChat:F,onShowDashboard:M,peerError:m,isReady:U,onRetry:A,sessions:L,activeSessionId:T,onSwitchSession:V,onCreateNewSession:G,onDeleteSession:H,isReconnecting:O,rooms:E,onSelectRoom:J})=>{const{viewMode:o,setViewMode:f,selectedPeerId:q,setShowSettings:B,activeRoomId:K,setShowCreateRoomModal:Y,setShowJoinRoomModal:_}=de(),[c,j]=n.useState(""),[z,x]=n.useState(!1),[N,w]=n.useState(!1),Q=()=>{const s=`${window.location.origin}/#connect=${i}`;navigator.clipboard.writeText(s),w(!0),setTimeout(()=>w(!1),2e3)},[p,h]=n.useState(null),[v,y]=n.useState(""),W=s=>{s.preventDefault(),c&&c!==i&&(D(c),j(""),x(!1))},X=(s,t)=>{s.stopPropagation(),h(t.peerId),y(t.name||t.peerId)},C=s=>{s==null||s.preventDefault(),p&&(F(p,v),h(null))},Z=s=>{h(null)},I=Object.values(P).sort((s,t)=>t.lastUpdated-s.lastUpdated),k=Object.values(E).sort((s,t)=>t.lastUpdated-s.lastUpdated);return e.jsxs("div",{className:"w-full h-full bg-slate-900 border-r border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ee,{className:"w-6 h-6 text-primary-500"}),"Ping"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,className:"md:hidden p-2 text-slate-400 hover:text-white bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",title:"View Dashboard",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>B(!0),className:"p-2 text-slate-400 hover:text-white bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",title:"Connection Settings",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("a",{href:"https://github.com/HoangTran0410/chat-p2p",target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-400 hover:text-white bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors",title:"GitHub Repo",children:e.jsx(ae,{className:"w-5 h-5"})})]})]}),e.jsx(ce,{sessions:L,activeSessionId:T,onSwitchSession:V,onCreateNewSession:G,onDeleteSession:H,isReady:U,peerError:m,onRetry:A,isReconnecting:O}),m&&e.jsx("div",{className:"mt-2 text-xs text-red-400 font-medium px-1",children:m})]}),e.jsxs("div",{className:"flex border-b border-slate-800",children:[e.jsx("button",{onClick:()=>f("chats"),className:`flex-1 py-2.5 text-sm font-medium transition-colors ${o==="chats"?"text-white border-b-2 border-primary-500 bg-slate-800/50":"text-slate-500 hover:text-slate-300"}`,children:"Chats"}),e.jsx("button",{onClick:()=>f("rooms"),className:`flex-1 py-2.5 text-sm font-medium transition-colors ${o==="rooms"?"text-white border-b-2 border-purple-500 bg-slate-800/50":"text-slate-500 hover:text-slate-300"}`,children:"Rooms"})]}),o==="chats"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4",children:z?e.jsxs("form",{onSubmit:W,className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-200",children:[e.jsx("input",{type:"text",value:c,onChange:s=>j(s.target.value),placeholder:"Enter Peer ID...",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-primary-500 transition-colors",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-primary-600 hover:bg-primary-500 text-white py-1.5 rounded text-sm font-medium",children:"Connect"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-3 bg-slate-800 hover:bg-slate-700 text-slate-300 py-1.5 rounded text-sm",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Q,className:`flex-1 py-2.5 px-4 rounded-lg flex items-center justify-center gap-2 transition-all font-medium ${N?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-slate-800 hover:bg-slate-700 text-slate-200"}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"w-4 h-4"}),"Invite"]})}),e.jsxs("button",{onClick:()=>x(!0),className:"flex-1 py-2.5 px-4 bg-primary-600 hover:bg-primary-500 text-white rounded-lg flex items-center justify-center gap-2 transition-all font-medium shadow-lg shadow-primary-900/20",children:[e.jsx(S,{className:"w-4 h-4"}),"New Chat"]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:I.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 text-sm",children:[e.jsx(b,{className:"w-10 h-10 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No chats yet."}),e.jsx("p",{className:"mt-2 text-xs opacity-60",children:"Share your ID or enter a friend's ID to start."})]}):e.jsx("ul",{className:"space-y-1 px-2",children:I.map(s=>{const t=$.includes(s.peerId),d=q===s.peerId,r=s.messages[s.messages.length-1],a=p===s.peerId;return e.jsx("li",{children:e.jsxs("div",{className:`w-full text-left p-3 rounded-lg transition-all flex items-center gap-3 relative group ${d?"bg-slate-800 border border-slate-700 shadow-sm":"hover:bg-slate-800/50 border border-transparent"}`,children:[e.jsxs("button",{onClick:()=>g(s.peerId),className:"relative shrink-0",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${d?"bg-primary-600 text-white":"bg-slate-700 text-slate-300"}`,children:(s.name||s.peerId).slice(0,2).toUpperCase()}),t&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-slate-900 rounded-full"})]}),e.jsx("div",{className:"flex-1 min-w-0",onClick:()=>!a&&g(s.peerId),children:a?e.jsx("form",{onSubmit:C,className:"flex items-center gap-2",onClick:l=>l.stopPropagation(),children:e.jsx("input",{autoFocus:!0,value:v,onChange:l=>y(l.target.value),onBlur:()=>C(),onKeyDown:l=>{l.key==="Escape"&&Z()},className:"w-full bg-slate-950 border border-primary-500/50 rounded px-1.5 py-0.5 text-sm text-white focus:outline-none"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[e.jsx("span",{className:`font-medium text-slate-200 truncate text-sm cursor-pointer ${s.name?"":"font-mono"}`,children:s.name||s.peerId}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[e.jsx("button",{onClick:l=>X(l,s),className:"hidden md:block text-slate-500 hover:text-primary-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Rename Contact",children:e.jsx(ne,{className:"w-3 h-3"})}),r&&e.jsx("span",{className:"text-[10px] text-slate-500",children:R(r.timestamp,{addSuffix:!1}).replace("about ","")})]})]}),e.jsx("div",{className:"text-xs text-slate-400 truncate h-4 cursor-pointer",children:r?r.content:e.jsx("span",{className:"italic opacity-50",children:"No messages"})})]})})]})},s.peerId)})})})]}),o==="rooms"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 flex gap-2",children:[e.jsxs("button",{onClick:()=>_(!0),className:"flex-1 py-2.5 px-4 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-lg flex items-center justify-center gap-2 transition-all font-medium",children:[e.jsx(ie,{className:"w-4 h-4"}),"Join"]}),e.jsxs("button",{onClick:()=>Y(!0),className:"flex-1 py-2.5 px-4 bg-purple-600 hover:bg-purple-500 text-white rounded-lg flex items-center justify-center gap-2 transition-all font-medium shadow-lg shadow-purple-900/20",children:[e.jsx(S,{className:"w-4 h-4"}),"Create"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:k.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 text-sm",children:[e.jsx(b,{className:"w-10 h-10 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"No rooms yet."}),e.jsx("p",{className:"mt-2 text-xs opacity-60",children:"Create or join a room to chat with multiple people."})]}):e.jsx("ul",{className:"space-y-1 px-2",children:k.map(s=>{var l;const t=K===s.roomId,d=s.hostId===i,r=s.members.filter(u=>u.isOnline).length,a=s.messages[s.messages.length-1];return e.jsx("li",{children:e.jsxs("button",{onClick:()=>J(s.roomId),className:`w-full text-left p-3 rounded-lg transition-all flex items-center gap-3 ${t?"bg-slate-800 border border-slate-700 shadow-sm":"hover:bg-slate-800/50 border border-transparent"}`,children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-sm font-bold ${t?"bg-purple-600 text-white":"bg-slate-700 text-slate-300"}`,children:e.jsx(b,{className:"w-5 h-5"})}),d&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 border-2 border-slate-900 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-2.5 h-2.5 text-slate-900"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[e.jsx("span",{className:"font-medium text-slate-200 truncate text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[e.jsxs("span",{className:"text-[10px] text-slate-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),r]}),a&&e.jsx("span",{className:"text-[10px] text-slate-500",children:R(a.timestamp,{addSuffix:!1}).replace("about ","")})]})]}),e.jsx("div",{className:"text-xs text-slate-400 truncate h-4",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium text-slate-500",children:[a.senderId===i?"You":((l=s.members.find(u=>u.peerId===a.senderId))==null?void 0:l.name)||a.senderId.slice(0,6),":"]})," ",a.content]}):e.jsx("span",{className:"italic opacity-50",children:"No messages yet"})})]})]})},s.roomId)})})})]})]})};export{he as C};
