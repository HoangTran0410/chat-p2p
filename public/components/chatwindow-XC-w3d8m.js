import{r as n,j as e,c as V,A as T,d as me,e as qe,g as he,h as fe,i as pe,R as N,k as ue,I as Ye,X as H,l as be,m as M,n as p,o as je,C as X,p as ge,q as Ze,s as Je,U as Qe,t as F,u as et,M as tt,v as st,T as at,F as lt}from"../vendor-CdBe9qih.js";import{u as nt,a as rt,b as q,g as Ne,M as it,F as ct}from"../index-Fs2phppL.js";import{g as ot}from"../services/storage-CphQKvNS.js";import{G as dt}from"./gameselector-DIblEhII.js";import{G as xt}from"./gamecontainer-BIudOPOB.js";const gt=({onSendMessage:l,onResendMessage:u,onRequestSync:z,onSendFileChunked:b,sendingProgress:o,receivingProgress:m,peerFingerprint:f,isEncrypted:h})=>{var xe;const{backToSidebar:A,chats:Y,typingStates:we,selectedPeerId:ve,renameChat:ye,deleteChat:Ce}=nt(),{myId:k,isReady:S,peerError:Z,activeConnectionsCount:ke,sendMessage:D,connectionStates:Se,updateId:Ie,connectToPeer:Re,disconnectPeer:J}=rt(),a=ve||"",s=a?Y[a]:void 0,$e=Object.keys(Y).length,Q=a?we[a]??!1:!1,d=a&&Se[a]||"disconnected",Ee=()=>{k&&Ie(k)},L=()=>{a&&Re(a)},Te=()=>{a&&J(a)},Me=()=>{a&&Ce(a,J)},Fe=t=>{a&&ye(a,t)},[w,ee]=n.useState(""),[te,ze]=n.useState(null),[I,se]=n.useState(!1),[Ae,G]=n.useState(!1),[ae,le]=n.useState(""),ne=n.useRef(null),j=n.useRef(null),[R,U]=n.useState(null),[De,P]=n.useState(!1),[B,W]=n.useState(!1),{createGame:re,pendingInvites:Le,acceptInvite:Ge,declineInvite:Ue,activeGame:$}=q(),[g,Pe]=n.useState("horizontal"),v=n.useRef(null),y=n.useRef(!1),[x,E]=n.useState("chat"),[Be,We]=n.useState(Date.now()),ie=()=>{var t;(t=ne.current)==null||t.scrollIntoView({behavior:"smooth"})};n.useEffect(()=>{x==="chat"&&(We(Date.now()),ie())},[x,s==null?void 0:s.messages.length]);const ce=(s==null?void 0:s.messages.filter(t=>t.timestamp>Be&&t.senderId!==k).length)||0;n.useEffect(()=>{const{activeGame:t}=q.getState();(t==null?void 0:t.status)==="playing"&&window.innerWidth<768&&E("game")},[(xe=q.getState().activeGame)==null?void 0:xe.status]),n.useEffect(()=>{ie()},[s==null?void 0:s.messages,Q]);const O=t=>{D&&a&&d==="connected"&&D(a,{type:"typing",isTyping:t})},Oe=t=>{const r=t.target.value;ee(r),D&&d==="connected"&&(y.current||(y.current=!0,O(!0)),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{y.current=!1,O(!1)},2e3))},oe=t=>{t.preventDefault(),w.trim()&&(l(w),ee(""),v.current&&clearTimeout(v.current),y.current&&(y.current=!1,O(!1)))},Ke=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),oe(t))},_e=async t=>{var c;const r=(c=t.target.files)==null?void 0:c[0];if(r){if(r.size>it){U(r),P(!0),j.current&&(j.current.value="");return}await de(r),j.current&&(j.current.value="")}},de=async t=>{let r="file";if(t.type.startsWith("image/")?r="image":t.type.startsWith("video/")&&(r="video"),b&&t.size>ct*2){const _=ot();b(_,t,r);return}const c=await t.arrayBuffer(),K={type:r,content:t.name,file:{name:t.name,size:t.size,mimeType:t.type,data:c}};l(K)},Ve=async()=>{R&&(await de(R),U(null)),P(!1)},He=()=>{U(null),P(!1)},Xe=()=>{var t;(t=j.current)==null||t.click()};if(!a)return e.jsx("div",{className:"flex-1 flex flex-col h-full bg-slate-950 overflow-y-auto",children:e.jsxs("div",{className:"flex-1 p-6 md:p-12 max-w-4xl mx-auto w-full flex flex-col",children:[e.jsx("div",{className:"md:hidden flex items-center mb-4",children:e.jsxs("button",{onClick:A,className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Back to Chats"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center py-12",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4 ${S?"bg-green-500/10 border border-green-500/30":"bg-yellow-500/10 border border-yellow-500/30"}`,children:e.jsx(T,{className:`w-10 h-10 ${S?"text-green-500":"text-yellow-500 animate-pulse"}`})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:S?"You're Online":"Connecting..."}),e.jsx("p",{className:"text-slate-400 text-sm max-w-md",children:S?"Your P2P connection is active. Select a chat to start messaging.":"Establishing secure connection to the network..."}),Z&&e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-sm text-red-400",children:Z}),e.jsx("button",{onClick:Ee,className:"text-sm text-primary-400 hover:text-primary-300 underline",children:"Retry"})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-center",children:[e.jsxs("div",{className:"px-6 py-4 bg-slate-900/50 border border-slate-800 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:ke}),e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mt-1",children:"Active"})]}),e.jsxs("div",{className:"px-6 py-4 bg-slate-900/50 border border-slate-800 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:$e}),e.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-wider mt-1",children:"Chats"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs text-slate-600 border-t border-slate-800 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"E2E Encrypted"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(qe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Serverless"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(T,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"WebRTC"})]})]})]})});const C=(()=>{switch(d){case"connected":return{color:"bg-green-500",text:"Connected",subtext:"End-to-end encrypted",icon:e.jsx(me,{className:"w-3 h-3"})};case"connecting":return{color:"bg-yellow-500 animate-pulse",text:"Connecting...",subtext:"Waiting for peer response",icon:e.jsx(T,{className:"w-3 h-3 animate-spin"})};case"failed":return{color:"bg-red-500",text:"Connection Failed",subtext:"Peer offline or not found",icon:e.jsx(M,{className:"w-3 h-3"})};default:return{color:"bg-slate-600",text:"Disconnected",subtext:"Session offline",icon:e.jsx(pe,{className:"w-3 h-3"})}}})(),i=d==="connected";return e.jsxs("div",{className:"flex-1 flex h-full bg-slate-950 relative",children:[e.jsxs("div",{className:`flex-1 flex flex-col min-w-0 ${I?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"h-16 border-b border-slate-800 flex items-center justify-between px-4 bg-slate-950/80 backdrop-blur-sm z-10 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("button",{onClick:A,className:"md:hidden p-2 -ml-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("h2",{className:"font-semibold text-slate-100 flex items-center gap-2 truncate text-base",children:e.jsx("span",{className:`${s!=null&&s.name?"font-sans":"font-mono tracking-wide"} truncate`,children:(s==null?void 0:s.name)||a})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${C.color}`}),e.jsxs("span",{className:`${d==="failed"?"text-red-400":"text-slate-400"} flex items-center gap-1.5`,children:[(s==null?void 0:s.name)&&e.jsx("span",{className:"text-slate-500 font-mono tracking-tight mr-1 border-r border-slate-800 pr-2",children:a}),C.text]}),i&&e.jsxs("span",{className:`flex items-center gap-1 px-1.5 py-0.5 rounded-full text-[10px] font-medium ${h?"bg-primary-500/10 text-primary-400":"bg-slate-700/50 text-slate-500"}`,title:f||(h?"E2EE Active":"Unencrypted"),children:[h?e.jsx(he,{className:"w-2.5 h-2.5"}):e.jsx(fe,{className:"w-2.5 h-2.5"}),h?"E2EE":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-2",children:[d==="connecting"&&e.jsxs("button",{onClick:Te,className:"px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 text-xs font-medium rounded-lg transition-colors flex items-center gap-1.5",children:[e.jsx(pe,{className:"w-3.5 h-3.5"}),"Cancel"]}),(d==="failed"||d==="disconnected")&&e.jsxs("button",{onClick:L,className:"px-3 py-1.5 bg-primary-600/20 hover:bg-primary-600/30 text-primary-400 text-xs font-medium rounded-lg transition-colors flex items-center gap-1.5",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),"Reconnect"]}),$&&e.jsx("button",{onClick:()=>Pe(g==="vertical"?"horizontal":"vertical"),className:"hidden md:block p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",title:g==="vertical"?"Switch to Split View":"Switch to Stacked View",children:g==="vertical"?e.jsx(ue,{className:"w-5 h-5 rotate-90"}):e.jsx(ue,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>se(!I),className:`p-2 rounded-lg transition-colors ${I?"text-primary-400 bg-primary-600/20":"text-slate-400 hover:text-white hover:bg-slate-800"}`,title:"Conversation Info",children:e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors hidden md:block",title:"Close Chat",children:e.jsx(H,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"md:hidden flex border-b border-slate-800 bg-slate-900/50",children:[e.jsxs("button",{onClick:()=>E("chat"),className:`flex-1 py-3 text-sm font-medium relative ${x==="chat"?"text-primary-400":"text-slate-400"}`,children:["Chat",ce>0&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-[10px] bg-red-500 text-white rounded-full",children:ce}),x==="chat"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary-500"})]}),e.jsxs("button",{onClick:()=>E("game"),className:`flex-1 py-3 text-sm font-medium relative ${x==="game"?"text-primary-400":"text-slate-400"}`,children:["Game",x==="game"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary-500"})]})]}),Le.map(t=>{if(t.hostId!==a)return null;const r=Ne.getDefinition(t.gameType);return r?e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-slate-800/80 border border-slate-700 rounded-lg flex items-center justify-between animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:r.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-200",children:["Game Invite: ",r.name]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Invited you to play"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Ue(t.sessionId),className:"px-3 py-1.5 text-xs font-medium text-slate-300 hover:text-white hover:bg-slate-700 rounded-md transition-colors",children:"Decline"}),e.jsx("button",{onClick:()=>Ge(t.sessionId),className:"px-3 py-1.5 text-xs font-medium text-white bg-primary-600 hover:bg-primary-500 rounded-md transition-colors shadow-lg shadow-primary-900/20",children:"Accept"})]})]},t.sessionId):null}),e.jsxs("div",{className:`flex-1 flex flex-col min-h-0 ${g==="horizontal"?"md:flex-row":"md:flex-col"}`,children:[($||x==="game")&&e.jsxs("div",{className:`
                ${x==="game"?"flex":"hidden"}
                ${$?"md:flex":""}
                flex-1 flex-col min-h-0 min-w-0 overflow-y-auto
                ${g==="horizontal"?"md:order-2":"md:order-1 md:border-b md:border-slate-800"}
              `,children:[e.jsx(xt,{}),!$&&e.jsxs("div",{className:"flex-1 p-6 flex flex-col items-center justify-center text-center animate-in fade-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-800 rounded-2xl flex items-center justify-center mb-6 shadow-xl border border-slate-700 rotate-3",children:e.jsx(be,{className:"w-8 h-8 text-primary-400"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Play a Game"}),e.jsx("p",{className:"text-slate-400 mb-8 max-w-xs text-sm leading-relaxed",children:"Challenge your friend to a game directly in the chat. Select a game below to send an invite."}),e.jsx("div",{className:"grid gap-3 w-full max-w-sm",children:Ne.getAllDefinitions().map(t=>e.jsxs("button",{onClick:()=>{a&&re(t.id,a)},className:"flex items-center gap-4 p-4 bg-slate-800/50 hover:bg-slate-800 border border-slate-700/50 hover:border-primary-500/50 rounded-xl transition-all group text-left",children:[e.jsx("div",{className:"text-3xl group-hover:scale-110 transition-transform duration-300 bg-slate-900 rounded-lg p-2",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-slate-200 group-hover:text-primary-400 transition-colors",children:t.name}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5 line-clamp-1",children:t.description})]}),e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0 duration-300",children:e.jsx(V,{className:"w-5 h-5 text-slate-400 rotate-180"})})]},t.id))})]})]}),e.jsxs("div",{className:`
              ${x==="chat"?"flex":"hidden"}
              md:flex
              flex-1 flex-col min-h-0 min-w-0
              ${g==="horizontal"?"md:order-1 md:border-r md:border-slate-800":"md:order-2"}
            `,children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[!s||s.messages.length===0?e.jsx("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 text-sm p-4 text-center",children:d==="connecting"?e.jsxs("div",{className:"flex flex-col items-center gap-3 animate-pulse",children:[e.jsx(T,{className:"w-8 h-8 text-primary-500 opacity-50"}),e.jsx("p",{children:"Establishing secure connection..."})]}):d==="failed"?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(M,{className:"w-8 h-8 text-red-500 opacity-50"}),e.jsx("p",{className:"text-red-400/80",children:"Could not connect to peer."}),e.jsx("button",{onClick:L,className:"text-primary-500 hover:underline",children:"Try Again"})]}):e.jsx("p",{children:"No messages yet. Say hello!"})}):s.messages.map((t,r)=>{const c=t.senderId===k,K=r===0||t.timestamp-s.messages[r-1].timestamp>3e5;return e.jsxs("div",{className:"space-y-2",children:[K&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx("span",{className:"text-[10px] text-slate-600 bg-slate-900/50 px-2 py-0.5 rounded-full border border-slate-800",children:p(t.timestamp,"MMM d, h:mm a")})}),e.jsxs("div",{className:`flex flex-col ${c?"items-end":"items-start"}`,children:[e.jsxs("div",{onClick:()=>ze(te===t.id?null:t.id),className:`max-w-[85%] sm:max-w-[75%] px-4 py-2.5 rounded-2xl text-sm leading-relaxed shadow-sm break-words cursor-pointer transition-all hover:opacity-90 ${c?"bg-primary-600 text-white rounded-br-sm":"bg-slate-800 text-slate-200 border border-slate-700 rounded-bl-sm"}`,children:[e.jsx(mt,{message:t}),e.jsxs("div",{className:`text-[10px] mt-1 flex items-center gap-1 ${c?"text-primary-200":"text-slate-500"}`,children:[t.encrypted?e.jsx(he,{className:"w-2.5 h-2.5 opacity-60"}):e.jsx(fe,{className:"w-2.5 h-2.5 opacity-40"}),p(t.timestamp,"h:mm a"),c&&t.status&&e.jsxs("span",{className:"ml-1",children:[t.status==="read"&&e.jsx(je,{className:"w-3 h-3"}),t.status==="delivered"&&e.jsx(X,{className:"w-3 h-3"}),t.status==="sent"&&e.jsx(X,{className:"w-3 h-3 opacity-50"}),t.status==="failed"&&e.jsx(M,{className:"w-3 h-3 text-red-200"})]})]})]}),c&&t.status==="failed"&&e.jsxs("button",{onClick:_=>{_.stopPropagation(),u(t.id)},className:"text-xs text-red-400 hover:text-red-300 flex items-center gap-1 mt-1 px-1 transition-colors",children:[e.jsx(N,{className:"w-3 h-3"}),"Tap to retry"]}),te===t.id&&e.jsxs("div",{className:`mt-1 px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 text-xs space-y-1 max-w-[85%] ${c?"mr-0":"ml-0"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(ge,{className:"w-3 h-3"}),e.jsxs("span",{children:["Sent:"," ",p(t.timestamp,"MMM d, yyyy h:mm:ss a")]})]}),t.receivedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(X,{className:"w-3 h-3"}),e.jsxs("span",{children:["Delivered:"," ",p(t.receivedAt,"h:mm:ss a")]})]}),t.readAt&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(je,{className:"w-3 h-3"}),e.jsxs("span",{children:["Read: ",p(t.readAt,"h:mm:ss a")]})]})]})]})]},t.id)}),Q&&e.jsx("div",{className:"flex justify-start animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-2xl rounded-bl-sm px-4 py-3 flex items-center gap-1 w-fit",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"})]})}),e.jsx("div",{ref:ne})]}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-slate-800 bg-slate-950 safe-area-bottom",children:e.jsxs("form",{onSubmit:oe,className:`relative flex items-end gap-0 md:gap-2 p-2 rounded-xl border ${i?"border-slate-700 bg-slate-900 focus-within:border-primary-500/50 focus-within:ring-1 focus-within:ring-primary-500/50":"border-slate-800 bg-slate-900/50 opacity-75"} transition-all`,children:[e.jsx("input",{type:"file",ref:j,onChange:_e,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>W(!B),disabled:!i,className:`hidden md:block p-2.5 rounded-lg mb-0.5 transition-all text-slate-400 hover:text-white hover:bg-slate-800 ${i?"":"cursor-not-allowed opacity-50"} ${B?"bg-slate-800 text-white":""}`,title:"Play a game",children:e.jsx(be,{className:"w-5 h-5"})}),B&&e.jsx(dt,{onSelect:t=>{a&&(re(t,a),W(!1),window.innerWidth<768&&E("game"))},onClose:()=>W(!1)}),e.jsx("button",{type:"button",onClick:Xe,disabled:!i,className:`p-2.5 rounded-lg mb-0.5 transition-all text-slate-400 hover:text-white hover:bg-slate-800 ${i?"":"cursor-not-allowed opacity-50"}`,title:"Attach File",children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx("textarea",{value:w,onChange:Oe,onKeyDown:Ke,disabled:!i,placeholder:i?"Type a message...":`Status: ${C.text}`,className:"flex-1 bg-transparent border-none focus:ring-0 text-slate-200 placeholder-slate-500 resize-none py-2.5 px-2 max-h-32 text-sm disabled:opacity-50 outline-none",rows:1,style:{minHeight:"44px"}}),e.jsx("button",{type:"submit",disabled:!w.trim()||!i,className:`p-2.5 rounded-lg mb-0.5 transition-all ${w.trim()&&i?"bg-primary-600 text-white hover:bg-primary-500 shadow-lg shadow-primary-900/20":"bg-slate-800 text-slate-500 cursor-not-allowed"}`,children:e.jsx(Je,{className:"w-5 h-5"})})]})})]})]})]}),I&&e.jsxs("div",{className:"w-full md:w-80 border-l border-slate-800 bg-slate-900 flex flex-col overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Conversation Info"}),e.jsx("button",{onClick:()=>se(!1),className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors md:hidden",children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i?"bg-green-500/20":"bg-slate-700"}`,children:e.jsx(Qe,{className:`w-6 h-6 ${i?"text-green-400":"text-slate-400"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[Ae?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:ae,onChange:t=>le(t.target.value),className:"flex-1 bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm text-white focus:border-primary-500 outline-none",placeholder:"Enter nickname...",autoFocus:!0}),e.jsx("button",{onClick:()=>{Fe(ae),G(!1)},className:"p-1 bg-primary-600 hover:bg-primary-500 text-white rounded",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(!1),className:"p-1 bg-slate-700 hover:bg-slate-600 text-white rounded",children:e.jsx(H,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-white truncate",children:(s==null?void 0:s.name)||"Peer"}),e.jsx("button",{onClick:()=>{le((s==null?void 0:s.name)||""),G(!0)},className:"p-1 text-slate-400 hover:text-white hover:bg-slate-700 rounded transition-colors",title:"Edit name",children:e.jsx(et,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-slate-400 font-mono truncate",children:a})]})]}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium ${i?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${C.color}`}),C.text]})]}),e.jsxs("div",{className:"p-4 border-b border-slate-800 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-400 flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4"}),"Total Messages"]}),e.jsx("span",{className:"text-white font-medium",children:(s==null?void 0:s.messages.length)||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-400 flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),"First Message"]}),e.jsx("span",{className:"text-white font-medium",children:s!=null&&s.messages[0]?p(s.messages[0].timestamp,"MMM d, yyyy"):"-"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-400 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Last Activity"]}),e.jsx("span",{className:"text-white font-medium",children:s!=null&&s.lastUpdated?p(s.lastUpdated,"MMM d, h:mm a"):"-"})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[i&&e.jsxs("button",{onClick:z,className:"w-full py-2.5 px-4 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-lg flex items-center justify-center gap-2 transition-colors text-sm font-medium",children:[e.jsx(N,{className:"w-4 h-4"}),"Sync History"]}),!i&&e.jsxs("button",{onClick:L,className:"w-full py-2.5 px-4 bg-primary-600 hover:bg-primary-500 text-white rounded-lg flex items-center justify-center gap-2 transition-colors text-sm font-medium",children:[e.jsx(N,{className:"w-4 h-4"}),"Reconnect"]}),e.jsxs("button",{onClick:Me,className:"w-full py-2.5 px-4 bg-red-950/50 hover:bg-red-950 text-red-400 rounded-lg flex items-center justify-center gap-2 transition-colors text-sm font-medium",children:[e.jsx(at,{className:"w-4 h-4"}),"Delete Conversation"]})]})]}),De&&R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-6 max-w-sm w-full shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-500/20 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Large File"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[(R.size/1024/1024).toFixed(1)," MB"]})]})]}),e.jsx("p",{className:"text-slate-300 mb-6 text-sm",children:"This file is larger than 50MB. Sending large files may take a while and could fail on slow connections."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:He,className:"flex-1 py-2.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ve,className:"flex-1 py-2.5 bg-primary-600 hover:bg-primary-500 text-white rounded-lg transition-colors",children:"Send Anyway"})]})]})}),o&&e.jsxs("div",{className:"fixed bottom-24 left-1/2 -translate-x-1/2 bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 shadow-xl z-40 flex items-center gap-3 min-w-[200px]",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(N,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1",children:"Sending file..."}),e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary-500 transition-all duration-200",style:{width:`${o.progress}%`}})})]}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[o.progress,"%"]})]}),m&&e.jsxs("div",{className:"fixed bottom-24 left-1/2 -translate-x-1/2 bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 shadow-xl z-40 flex items-center gap-3 min-w-[200px]",children:[e.jsx("div",{className:"animate-spin",children:e.jsx(N,{className:"w-4 h-4 text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-xs text-slate-400 mb-1 truncate max-w-[120px]",children:["Receiving: ",m.fileName]}),e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-200",style:{width:`${m.progress}%`}})})]}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[m.progress,"%"]})]})]})};function mt({message:l}){const[u,z]=n.useState(null);n.useEffect(()=>{var o;if((o=l.file)!=null&&o.data&&(l.type==="image"||l.type==="video")){const m=l.file.data instanceof Blob?l.file.data:new Blob([l.file.data]),f=URL.createObjectURL(m);return z(f),()=>URL.revokeObjectURL(f)}},[l]);const b=o=>{if(o==null||o.stopPropagation(),!l.file)return;const m=l.file.data instanceof Blob?l.file.data:new Blob([l.file.data]),f=URL.createObjectURL(m),h=document.createElement("a");h.href=f,h.download=l.file.name,h.click(),URL.revokeObjectURL(f)};return l.type==="image"&&u?e.jsxs("div",{className:"mb-2 max-w-sm relative group",children:[e.jsx("img",{src:u,alt:l.content,className:"rounded-lg border border-slate-700 w-full h-auto object-contain"}),e.jsx("button",{onClick:b,className:"absolute top-2 right-2 p-1.5 bg-black/50 hover:bg-black/70 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Download",children:e.jsx("div",{className:"w-4 h-4",children:e.jsx(F,{className:"w-4 h-4"})})})]}):l.type==="video"&&u?e.jsxs("div",{className:"mb-2 max-w-sm relative group",children:[e.jsx("video",{src:u,controls:!0,className:"rounded-lg border border-slate-700 w-full"}),e.jsx("button",{onClick:b,className:"absolute top-2 right-2 p-1.5 bg-black/50 hover:bg-black/70 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Download",children:e.jsx("div",{className:"w-4 h-4",children:e.jsx(F,{className:"w-4 h-4"})})})]}):l.type==="file"&&l.file?e.jsxs("div",{className:"mb-2 p-3 bg-slate-800 border border-slate-700 rounded-lg flex items-center gap-3 w-fit hover:bg-slate-750 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-700 rounded-lg flex items-center justify-center",children:e.jsx(lt,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate max-w-[150px]",children:l.file.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(l.file.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:b,className:"p-1.5 text-slate-400 hover:text-white hover:bg-slate-600 rounded",title:"Download",children:e.jsx(F,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"text-sm border-b border-slate-800/50 pb-2 mb-2 whitespace-pre-wrap",children:l.content})}export{gt as C};
